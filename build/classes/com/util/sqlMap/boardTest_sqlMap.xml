<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap
PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<!-- 여기에 이름을 사용할 수 있게 함 이름은 사용자정의 -->
<!--  boardTest에 있는 각각의 id를 호출할 수 있음 -->
<sqlMap namespace="boardTest">

<select id="maxNum" resultClass="int">
	select nvl(max(num),0) from board
</select>

<insert id="insertData" parameterClass="com.boardTest.BoardForm">
	insert into board (num,subject,name,email,content,pwd,ipAddr,hitCount,created) 
	values (#num#,#subject#,#name#,#email#,#content#,#pwd#,#ipAddr#,0,sysdate)
</insert>

<!-- 반복적인 내용을 처리하는 방법 -->
<sql id="where-list">
	<!-- property(searchKey)가 compareValue(name)일때 -->
	<isEqual property="searchKey" compareValue="name">
		where name like '%' || #searchValue# || '%'
	</isEqual>
	<isEqual property="searchKey" compareValue="subject">
		where subject like '%' || #searchValue# || '%'
	</isEqual>
	<isEqual property="searchKey" compareValue="content">
		where content like '%' || #searchValue# || '%'
	</isEqual>
</sql>

<!-- 전체 데이터 갯수 -->
<!-- resultClass : 반환값 변수형 -->
<!-- parameterClass : 필요한 변수 형 -->
<!-- map에 어떤 값이 오는지에 따라서 where-list의 isEqusl문을 include에 넣어서 실행 -->
<select id="dataCount" resultClass="int" parameterClass="map">
	 select nvl(count(num),0) from board
	 where $searchKey$ like '%' || #searchValue# || '%'
</select>
 <!-- include대신에 이렇게 사용 가능 -->
<!-- 
<include refid="where-list"/>
where $searchKey$ like '%' || #searchValue# || '%'
 -->

<!-- 다음 문장을 앞으로도 계속 사용할 때 다음과 같이 정의한 후 include를 이용하여 사용가능 -->
<sql id="field-list">
	num,name,subject,hitCount,to_char(created,'YYYY-MM-DD') created
</sql>

<!-- 전체 데이터 -->
<!-- <![CDATA[ ]]>  대괄호 안에 있는 문장은 무조건 텍스트로 변경 / <를 태그와 혼동하기 때문에 사용 -->
<select id="listData" resultClass="com.boardTest.BoardForm" parameterClass="map">
	select * from (
	select rownum rnum, data.* from (
	select <include refid="field-list"/> from board
	where $searchKey$ like '%' || #searchValue# || '%'
	order by num desc) data)
	<![CDATA[
	where rnum>=#start# and rnum<=#end#
	]]>
</select>

<select id="readData" resultClass="com.boardTest.BoardForm" parameterClass="int">
	select num,name,subject,email,pwd,content,ipAddr,hitCount,created 
	from board where num=#num#
</select>


<!-- 이전글 -->
<!-- 검색을 했다면 searchKey / searchValue값을 가지고 가야한다. -->
<select id="preReadData" resultClass="com.boardTest.BoardForm" parameterClass="map">
	select data.* from (
	select num,subject from board
	where ($searchKey$ like '%' || #searchValue# || '%')
	and (num>#num#) order by num asc) data
	where rownum=1
</select>

<!-- 다음글 -->
<select id="nextReadData" resultClass="com.boardTest.BoardForm" parameterClass="map">
<![CDATA[
	select data.* from (
	select num,subject from board
	where ($searchKey$ like '%' || #searchValue# || '%')
	and (num<#num#) order by num desc) data
	where rownum=1
]]>
</select>

<!-- 조회수 증가 -->
<update id="hitCountUpdate" parameterClass="int">
	update board set hitCount=hitCount+1
	where num = #num#
</update>

<!-- 수정 -->
<update id="updateData" parameterClass="com.boardTest.BoardForm">
	update board set name=#name#,subject=#subject#,email=#email#,content=#content#,pwd=#pwd# where num=#num#
</update>

<!-- 삭제 -->
<delete id="deleteData" parameterClass="int">
	delete board where num=#num#
</delete>

</sqlMap>